<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Teams SSO Auth</title>
  <script src="https://res.cdn.office.net/teams-js/2.17.0/js/MicrosoftTeams.min.js"></script>
  <style>
    body {
      background-color: #111;
      color: #f1f1f1;
      font-family: monospace;
      padding: 20px;
    }
    #log {
      white-space: pre-wrap;
      background: #222;
      padding: 15px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h2>ğŸ” Teams SSO Authentication</h2>
  <div id="log">ğŸ“¦ Page loaded...</div>

  <script>
    const log = (msg) => {
      document.getElementById("log").textContent += "\n" + msg;
    };

    log("ğŸ“¦ Initializing SDK...");

    microsoftTeams.app.initialize().then(() => {
      log("âœ… SDK initialized");

      microsoftTeams.authentication.getAuthToken({
        resources: ["https://graph.microsoft.com"],
        successCallback: (token) => {
          log("âœ… Token received");
          try {
            const payload = JSON.parse(atob(token.split(".")[1]));
            log("ğŸ” Token payload:");
            log("â€¢ aud: " + payload.aud);
            log("â€¢ scp: " + payload.scp);
            log("â€¢ upn: " + payload.upn);
          } catch {
            log("âš ï¸ Failed to decode token.");
          }

          microsoftTeams.authentication.notifySuccess(token);
        },
        failureCallback: (error) => {
          log("âŒ getAuthToken failed: " + error);
          microsoftTeams.authentication.notifyFailure(error);
        }
      });

    }).catch(err => {
      log("âŒ SDK init error: " + err.message);
    });
  </script>
</body>
</html>
