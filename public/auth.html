<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Teams SSO Auth</title>
  <script src="https://res.cdn.office.net/teams-js/2.17.0/js/MicrosoftTeams.min.js"></script>
  <style>
    body {
      background-color: #111;
      color: #f1f1f1;
      font-family: monospace;
      padding: 20px;
    }
    #log {
      white-space: pre-wrap;
      background: #222;
      padding: 15px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h2>🔐 Teams SSO Authentication</h2>
  <div id="log">📦 Page loaded...</div>

  <script>
    const log = (msg) => {
      document.getElementById("log").textContent += "\n" + msg;
    };

    log("📦 Initializing SDK...");

    microsoftTeams.app.initialize().then(() => {
      log("✅ SDK initialized");

      microsoftTeams.authentication.getAuthToken({
        resources: ["https://graph.microsoft.com"],
        successCallback: (token) => {
          log("✅ Token received");
          try {
            const payload = JSON.parse(atob(token.split(".")[1]));
            log("🔍 Token payload:");
            log("• aud: " + payload.aud);
            log("• scp: " + payload.scp);
            log("• upn: " + payload.upn);
          } catch {
            log("⚠️ Failed to decode token.");
          }

          microsoftTeams.authentication.notifySuccess(token);
        },
        failureCallback: (error) => {
          log("❌ getAuthToken failed: " + error);
          microsoftTeams.authentication.notifyFailure(error);
        }
      });

    }).catch(err => {
      log("❌ SDK init error: " + err.message);
    });
  </script>
</body>
</html>
