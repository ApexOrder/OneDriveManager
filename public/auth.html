<!DOCTYPE html>
<html>
<head>
  <title>Teams SSO Auth</title>
  <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>
  <style>
    body {
      background: #1e1e2f;
      color: #fff;
      font-family: Consolas, monospace;
      padding: 20px;
    }
    .log {
      background: #2b2b3d;
      padding: 10px;
      margin-top: 10px;
      border-left: 4px solid #ffd700;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>🔐 Loading authentication...</h2>
  <div id="log" class="log">📜 Starting...</div>

  <script>
    const log = (msg) => {
      console.log(msg);
      document.getElementById('log').textContent += `\n${msg}`;
    };

    log("🚀 Initializing Teams SDK...");

    microsoftTeams.app.initialize().then(() => {
      log("✅ Teams SDK initialized.");

      log("🎟️ Requesting token from Teams...");

      microsoftTeams.authentication.getAuthToken({
        successCallback: (token) => {
          log("✅ Token received.");
          
          try {
            const payload = JSON.parse(atob(token.split('.')[1]));
            log("📖 Token Payload:");
            log(`• aud: ${payload.aud}`);
            log(`• scp: ${payload.scp}`);
            log(`• upn: ${payload.upn}`);
            log(`• oid: ${payload.oid}`);
          } catch (e) {
            log("⚠️ Failed to decode token.");
          }

          log("📤 Sending token to Teams host...");
          microsoftTeams.authentication.notifySuccess(token);
        },
        failureCallback: (err) => {
          log(`❌ Auth failed: ${err}`);
          microsoftTeams.authentication.notifyFailure(err);
        }
      });
    }).catch(err => {
      log("❌ Teams SDK failed to initialize.");
      microsoftTeams.authentication.notifyFailure(err.message);
    });
  </script>
</body>
</html>
