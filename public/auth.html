<!DOCTYPE html>
<html>
<head>
  <title>Teams SSO Auth</title>
  <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"></script>
  <style>
    body {
      background: #1e1e2f;
      color: #fff;
      font-family: Consolas, monospace;
      padding: 20px;
    }
    .log {
      background: #2b2b3d;
      padding: 10px;
      margin-top: 10px;
      border-left: 4px solid #ffd700;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>ğŸ” Loading authentication...</h2>
  <div id="log" class="log">ğŸ“œ Starting...</div>

  <script>
    const log = (msg) => {
      console.log(msg);
      document.getElementById('log').textContent += `\n${msg}`;
    };

    log("ğŸš€ Initializing Teams SDK...");

    microsoftTeams.app.initialize().then(() => {
      log("âœ… Teams SDK initialized.");

      log("ğŸŸï¸ Requesting token from Teams...");

      microsoftTeams.authentication.getAuthToken({
        successCallback: (token) => {
          log("âœ… Token received.");
          
          try {
            const payload = JSON.parse(atob(token.split('.')[1]));
            log("ğŸ“– Token Payload:");
            log(`â€¢ aud: ${payload.aud}`);
            log(`â€¢ scp: ${payload.scp}`);
            log(`â€¢ upn: ${payload.upn}`);
            log(`â€¢ oid: ${payload.oid}`);
          } catch (e) {
            log("âš ï¸ Failed to decode token.");
          }

          log("ğŸ“¤ Sending token to Teams host...");
          microsoftTeams.authentication.notifySuccess(token);
        },
        failureCallback: (err) => {
          log(`âŒ Auth failed: ${err}`);
          microsoftTeams.authentication.notifyFailure(err);
        }
      });
    }).catch(err => {
      log("âŒ Teams SDK failed to initialize.");
      microsoftTeams.authentication.notifyFailure(err.message);
    });
  </script>
</body>
</html>
